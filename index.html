<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Mail Marketing Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Setup Wizard -->
    <div id="setupWizard" class="wizard-overlay hidden">
        <div class="wizard-container">
            <div class="wizard-header">
                <h2>ğŸš€ Willkommen beim E-Mail Marketing Tool</h2>
                <p>Lass uns dein Tool in 3 einfachen Schritten einrichten!</p>
                <div class="wizard-progress">
                    <div class="progress-step active" id="step1-indicator">1</div>
                    <div class="progress-step" id="step2-indicator">2</div>
                    <div class="progress-step" id="step3-indicator">3</div>
                </div>
            </div>

            <div class="wizard-content">
                <!-- Schritt 1: EmailJS Account -->
                <div class="wizard-step active" id="wizard-step-1">
                    <div class="step-intro">
                        <h3>ğŸ“§ EmailJS Account einrichten</h3>
                        <p>Zuerst benÃ¶tigen wir einen kostenlosen EmailJS Account fÃ¼r den E-Mail-Versand</p>
                    </div>

                    <div class="info-box">
                        <h4>ğŸ“‹ So geht's:</h4>
                        <ol>
                            <li>Gehe zu <a href="https://emailjs.com" target="_blank">emailjs.com</a></li>
                            <li>Erstelle einen kostenlosen Account</li>
                            <li>Verbinde deinen E-Mail-Provider (Gmail, Outlook, etc.)</li>
                            <li>Erstelle ein Email Template mit diesen Variablen:<br>
                                <code>{{to_name}}, {{from_name}}, {{subject}}, {{message}}</code><br>
                                <strong>Wichtig:</strong> FÃ¼r Attachments fÃ¼ge auch hinzu:<br>
                                <code>{{attachment1_name}}, {{attachment1_content}}, {{attachment_count}}</code></li>
                            <li>Kopiere die IDs hierher</li>
                        </ol>
                    </div>

                    <div class="form-group">
                        <label for="wizard-serviceId">Service ID:</label>
                        <input type="text" id="wizard-serviceId" placeholder="service_xxxxxxx">
                        <small>Unter "Email Services" in deinem Dashboard</small>
                    </div>

                    <div class="form-group">
                        <label for="wizard-templateId">Template ID:</label>
                        <input type="text" id="wizard-templateId" placeholder="template_xxxxxxx">
                        <small>Unter "Email Templates" in deinem Dashboard</small>
                    </div>

                    <div class="form-group">
                        <label for="wizard-userId">Public Key:</label>
                        <input type="text" id="wizard-userId" placeholder="E7m0JpVn9GC6WNcvF">
                        <small>Unter "Account" > "General" in deinem Dashboard</small>
                    </div>
                </div>

                <!-- Schritt 2: Absender-Info -->
                <div class="wizard-step" id="wizard-step-2">
                    <div class="step-intro">
                        <h3>ğŸ‘¤ Absender-Informationen</h3>
                        <p>Wie sollen deine E-Mails signiert werden?</p>
                    </div>

                    <div class="form-group">
                        <label for="wizard-fromName">Dein Name:</label>
                        <input type="text" id="wizard-fromName" placeholder="Anna MÃ¼ller">
                    </div>

                    <div class="form-group">
                        <label for="wizard-testEmail">Deine E-Mail (fÃ¼r Test):</label>
                        <input type="email" id="wizard-testEmail" placeholder="anna@example.com">
                        <small>Wir senden eine Test-E-Mail an diese Adresse</small>
                    </div>
                </div>

                <!-- Schritt 3: Test & Fertigstellung -->
                <div class="wizard-step" id="wizard-step-3">
                    <div class="step-intro">
                        <h3>ğŸ§ª Konfiguration testen</h3>
                        <p>Lass uns eine Test-E-Mail senden um sicherzustellen, dass alles funktioniert</p>
                    </div>

                    <div id="testEmailSection">
                        <button class="btn success" onclick="Wizard.sendTestEmail()" id="testEmailBtn">
                            ğŸ“¤ Test-E-Mail senden
                        </button>
                        <div id="testSpinner" class="spinner hidden"></div>
                        <div id="testResult"></div>
                    </div>

                    <div id="setupComplete" class="hidden">
                        <div class="success-box info-box">
                            <h4>ğŸ‰ Setup erfolgreich abgeschlossen!</h4>
                            <p>Dein E-Mail Marketing Tool ist jetzt einsatzbereit.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wizard-buttons">
                <button class="btn secondary" onclick="Wizard.previousStep()" id="prevBtn" disabled>â† ZurÃ¼ck</button>
                <button class="btn" onclick="Wizard.nextStep()" id="nextBtn">Weiter â†’</button>
                <button class="btn success hidden" onclick="Wizard.finishSetup()" id="finishBtn">ğŸš€ Tool starten</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container">
        <div class="header">
            <h1>ğŸ“§ E-Mail Marketing Tool</h1>
            <p>Einfaches Tool fÃ¼r personalisierte E-Mail-Kampagnen mit Attachments</p>
            <div class="wizard-trigger">
                <button class="btn secondary" onclick="Wizard.show()">âš™ï¸ Setup Wizard</button>
            </div>
        </div>

        <!-- Setup Prompt -->
        <div id="setupPrompt" class="setup-prompt hidden">
            <h2>ğŸ”§ Willkommen! Konfiguration erforderlich</h2>
            <p>Dein Tool ist noch nicht konfiguriert. FÃ¼hre das Setup aus um zu beginnen.</p>
            <button class="btn" onclick="Wizard.show()">âš™ï¸ Setup Wizard starten</button>
        </div>

        <!-- Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="App.showTab('template')">ğŸ“ Template</button>
            <button class="tab" onclick="App.showTab('recipients')">ğŸ‘¥ EmpfÃ¤nger</button>
            <button class="tab" onclick="App.showTab('send')">ğŸš€ Versenden</button>
            <button class="tab" onclick="App.showTab('config')">âš™ï¸ Konfiguration</button>
        </div>

        <!-- Template Tab -->
        <div id="template" class="tab-content active">
            <div class="section">
                <h3>E-Mail Template</h3>
                
                <div class="form-group">
                    <label>Template verwalten:</label>
                    <div class="template-controls">
                        <select id="savedTemplates" onchange="Templates.loadSelected()">
                            <option value="">-- Gespeicherte Templates --</option>
                        </select>
                        <input type="text" id="templateName" placeholder="Template Name">
                        <button class="btn" onclick="Templates.save()">ğŸ’¾ Speichern</button>
                        <button class="btn danger" onclick="Templates.deleteTemplate()">ğŸ—‘ï¸ LÃ¶schen</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="subject">Betreff:</label>
                    <input type="text" id="subject" placeholder="Hallo {{name}}, dein Update!" value="Hallo {{name}}, dein persÃ¶nliches Update!">
                </div>
                
                <div class="form-group">
                    <div class="editor-tabs">
                        <button type="button" class="tab active" id="simpleEditorTab" onclick="Templates.switchMode('simple')">ğŸ“ Einfacher Editor</button>
                        <button type="button" class="tab" id="htmlEditorTab" onclick="Templates.switchMode('html')">ğŸ”§ HTML Editor</button>
                    </div>
                </div>
                
                <div class="grid">
                    <div>
                        <div id="simpleEditor">
                            <label>Template bearbeiten:</label>
                            <div id="templateFields">
                                <p class="placeholder">Klicke auf "ğŸ”„ Template analysieren"</p>
                            </div>
                            <div class="editor-actions">
                                <button class="btn" onclick="Templates.parseTemplate()">ğŸ”„ Template analysieren</button>
                                <button class="btn success" onclick="Templates.applyChanges()" id="applyBtn" style="display: none;">âœ… Ã„nderungen Ã¼bernehmen</button>
                            </div>
                        </div>
                        
                        <div id="htmlEditor" style="display: none;">
                            <label for="htmlContent">HTML Template:</label>
                            <textarea id="htmlContent" class="editor" placeholder="Dein HTML Template hier..."></textarea>
                        </div>
                    </div>
                    <div>
                        <label>Live Vorschau:</label>
                        <small class="warning">âš ï¸ Die Vorschau kann leicht von der finalen E-Mail abweichen</small>
                        <div id="preview" class="preview">Vorschau wird hier angezeigt...</div>
                    </div>
                </div>
                <button class="btn" onclick="Templates.updatePreview()">Vorschau aktualisieren</button>
            </div>

            <!-- Attachments Section -->
            <div class="section">
                <h3>ğŸ“ Attachments</h3>
                
                <div class="form-group">
                    <label>Dateien hinzufÃ¼gen:</label>
                    <div class="attachment-upload">
                        <!-- File Input -->
                        <input type="file" id="attachmentFiles" multiple 
                               accept=".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx,.txt,.csv"
                               style="display: none;">
                        
                        <!-- Drag & Drop Zone -->
                        <div id="attachmentDropZone" class="attachment-drop-zone" 
                             onclick="document.getElementById('attachmentFiles').click()">
                            <div class="drop-zone-content">
                                <span class="drop-zone-icon">ğŸ“</span>
                                <div class="drop-zone-text">
                                    <strong>Dateien hier ablegen oder klicken</strong><br>
                                    <small>PDF, Bilder, Word, Excel, Text (max. 20MB pro Datei)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="attachmentStatus"></div>
                </div>
                
                <!-- Attachment List -->
                <div class="form-group">
                    <div id="attachmentList" class="attachment-list">
                        <p class="placeholder">Keine Attachments hinzugefÃ¼gt</p>
                    </div>
                    <div id="attachmentStats" class="attachment-stats"></div>
                </div>
                
                <div class="form-group">
                    <button class="btn danger" onclick="Attachments.clearAll()">ğŸ—‘ï¸ Alle Attachments entfernen</button>
                </div>
            </div>
        </div>

        <!-- Recipients Tab -->
        <div id="recipients" class="tab-content">
            <div class="section">
                <h3>EmpfÃ¤nger Liste</h3>
                
                <div class="form-group">
                    <label>EmpfÃ¤nger manuell hinzufÃ¼gen:</label>
                    <div class="recipient-input">
                        <input type="text" id="manualName" placeholder="Name (optional)">
                        <input type="email" id="manualEmail" placeholder="E-Mail">
                        <button class="btn" onclick="Recipients.addManual()">â• HinzufÃ¼gen</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>CSV-Datei hochladen:</label>
                    <div class="file-input">
                        <input type="file" id="csvFile" accept=".csv" onchange="Recipients.loadCSV()">
                        <div class="file-input-label">ğŸ“ CSV-Datei auswÃ¤hlen</div>
                    </div>
                    <small>Format: <strong>Nur E-Mails:</strong> eine pro Zeile <strong>ODER</strong> <strong>Name + E-Mail:</strong> zwei Spalten</small>
                </div>
                
                <div class="form-group">
                    <button class="btn" onclick="Recipients.loadTestData()">ğŸ§ª Test-Daten laden</button>
                    <button class="btn danger" onclick="Recipients.clear()">ğŸ—‘ï¸ Alle lÃ¶schen</button>
                </div>
                
                <div id="recipientsList" class="recipient-list">
                    <p class="placeholder">Keine EmpfÃ¤nger geladen</p>
                </div>
                <div id="recipientStats"></div>
            </div>
        </div>

        <!-- Send Tab -->
        <div id="send" class="tab-content">
            <div class="section">
                <h3>E-Mail Kampagne versenden</h3>
                <div id="sendStatus"></div>
                
                <div class="form-group">
                    <label>EmpfÃ¤nger Ãœbersicht:</label>
                    <div id="sendRecipientsList" class="recipient-list small">
                        <p class="placeholder">Keine EmpfÃ¤nger geladen - gehe zu "EmpfÃ¤nger" Tab</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Attachments:</label>
                    <div id="sendAttachmentInfo" class="send-attachment-info">
                        <p style="color: #7f8c8d; font-size: 14px;">Keine Attachments</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Versand-Geschwindigkeit:</label>
                    <select id="sendSpeed">
                        <option value="2000">Langsam (1 E-Mail alle 2 Sekunden)</option>
                        <option value="1000" selected>Normal (1 E-Mail pro Sekunde)</option>
                        <option value="500">Schnell (2 E-Mails pro Sekunde)</option>
                    </select>
                    <small>âš ï¸ Mit Attachments wird empfohlen, langsamer zu senden</small>
                </div>
                
                <div class="progress" id="progressContainer" style="display: none;">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div id="progressText" style="display: none;"></div>
                
                <button class="btn success" id="sendBtn" onclick="Sender.start()">ğŸ“¤ Kampagne starten</button>
                <button class="btn danger" id="stopBtn" onclick="Sender.stop()" style="display: none;">â¹ï¸ Stoppen</button>
            </div>
        </div>

        <!-- Config Tab -->
        <div id="config" class="tab-content">
            <div class="section">
                <h3>EmailJS Konfiguration</h3>
                <div class="info-box">
                    <strong>ğŸ’¡ Tipp:</strong> Nutze den Setup Wizard fÃ¼r eine gefÃ¼hrte Einrichtung!<br>
                    <strong>ğŸ“ Attachments:</strong> FÃ¼r AnhÃ¤nge muss dein EmailJS Template die Variablen 
                    <code>{{attachment1_name}}, {{attachment1_content}}, {{attachment_count}}</code> enthalten.
                </div>
                
                <div class="form-group">
                    <label for="serviceId">Service ID:</label>
                    <input type="text" id="serviceId" placeholder="service_xxxxxxx">
                </div>
                
                <div class="form-group">
                    <label for="templateId">Template ID:</label>
                    <input type="text" id="templateId" placeholder="template_xxxxxxx">
                </div>
                
                <div class="form-group">
                    <label for="userId">Public Key:</label>
                    <input type="text" id="userId" placeholder="E7m0JpVn9GC6WNcvF">
                </div>
                
                <div class="form-group">
                    <label for="fromName">Dein Name:</label>
                    <input type="text" id="fromName" placeholder="Anna MÃ¼ller">
                </div>
                
                <button class="btn" onclick="Config.save()">Konfiguration speichern</button>
                <div id="configStatus"></div>
            </div>

            <div class="section">
                <h3>Backup & Restore</h3>
                <div class="backup-controls">
                    <div>
                        <h4>ğŸ“¤ Exportieren</h4>
                        <button class="btn" onclick="Config.exportData()">ğŸ’¾ Backup herunterladen</button>
                    </div>
                    
                    <div>
                        <h4>ğŸ“¥ Importieren</h4>
                        <div class="file-input">
                            <input type="file" id="configFile" accept=".json" onchange="Config.importData()">
                            <div class="file-input-label">ğŸ“ .json Datei auswÃ¤hlen</div>
                        </div>
                    </div>
                </div>
                <div id="importStatus"></div>
            </div>
        </div>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Application Modules -->
    <script src="js/utils.js"></script>
    <script src="js/config.js"></script>
    <script src="js/wizard.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/recipients.js"></script>
    <script src="js/attachments.js"></script>
    <script src="js/sender.js"></script>
    <script src="js/app.js"></script>
</body>
</html>